<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Equilibrium">
  <meta name="description" content="Mental health companion - knows you need a break before you do">
  <title>Equilibrium - Mental Health Companion</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;overscroll-behavior:none;touch-action:pan-x pan-y}
    .install-prompt{position:fixed;bottom:20px;left:20px;right:20px;background:linear-gradient(135deg,#10b981,#14b8a6);color:white;padding:16px;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,0.3);z-index:1000;animation:slideUp 0.3s ease}
    @keyframes slideUp{from{transform:translateY(100px);opacity:0}to{transform:translateY(0);opacity:1}}
    input[type="range"]{-webkit-appearance:none;appearance:none;background:rgba(255,255,255,0.1);height:6px;border-radius:3px}
    input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;background:linear-gradient(135deg,#10b981,#14b8a6);border-radius:50%;cursor:pointer}
    input[type="range"]::-moz-range-thumb{width:20px;height:20px;background:linear-gradient(135deg,#10b981,#14b8a6);border-radius:50%;cursor:pointer;border:none}
  </style>
</head>
<body>
  <div id="root"></div>
  <script>
    if('serviceWorker' in navigator){
      window.addEventListener('load',()=>{
        const sw=`self.addEventListener('install',e=>{e.waitUntil(caches.open('eq-v1').then(c=>c.addAll(['/'])))});self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))});`;
        navigator.serviceWorker.register(URL.createObjectURL(new Blob([sw],{type:'application/javascript'})));
      });
    }
    const manifest={name:"Equilibrium - Mental Health Companion",short_name:"Equilibrium",start_url:"/",display:"standalone",background_color:"#0f172a",theme_color:"#0f172a",icons:[{src:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' fill='%230f172a'/%3E%3Ccircle cx='100' cy='100' r='60' fill='%2310b981'/%3E%3C/svg%3E",sizes:"192x192",type:"image/svg+xml",purpose:"any maskable"},{src:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%230f172a'/%3E%3Ccircle cx='256' cy='256' r='150' fill='%2310b981'/%3E%3C/svg%3E",sizes:"512x512",type:"image/svg+xml",purpose:"any maskable"}]};
    const link=document.createElement('link');
    link.rel='manifest';
    link.href='data:application/json;base64,'+btoa(JSON.stringify(manifest));
    document.head.appendChild(link);
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt',e=>{
      e.preventDefault();
      deferredPrompt=e;
      if(!localStorage.getItem('installDismissed')){
        const div=document.createElement('div');
        div.className='install-prompt';
        div.innerHTML='<div class="flex items-center justify-between gap-4"><div class="flex-1"><div class="font-semibold mb-1">Install Equilibrium</div><div class="text-sm opacity-90">Add to home screen for best experience</div></div><button onclick="installApp()" class="bg-white text-teal-600 px-4 py-2 rounded-lg font-medium">Install</button><button onclick="dismissInstall()" class="text-white/80 ml-2">âœ•</button></div>';
        document.body.appendChild(div);
      }
    });
    window.installApp=async()=>{
      if(deferredPrompt){
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt=null;
      }
      document.querySelector('.install-prompt')?.remove();
    };
    window.dismissInstall=()=>{
      localStorage.setItem('installDismissed','true');
      document.querySelector('.install-prompt')?.remove();
    };
    const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent);
    const isStandalone=window.navigator.standalone;
    if(isIOS&&!isStandalone&&!localStorage.getItem('iosDismissed')){
      setTimeout(()=>{
        const div=document.createElement('div');
        div.className='install-prompt';
        div.innerHTML='<div class="flex items-start justify-between gap-4"><div class="flex-1"><div class="font-semibold mb-2">Install on iOS</div><div class="text-sm opacity-90">Tap <b>Share âŽ™</b> then <b>Add to Home Screen</b></div></div><button onclick="this.parentElement.parentElement.remove();localStorage.setItem(\'iosDismissed\',\'true\');" class="text-white/80">âœ•</button></div>';
        document.body.appendChild(div);
      },2000);
    }
  </script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script>
    window.addEventListener('load',()=>{
      const {useState,useEffect}=React;
      const {render}=ReactDOM;
      const h=React.createElement;
      function App(){
        const[mode,setMode]=useState('login');
        const[email,setEmail]=useState('');
        const[pass,setPass]=useState('');
        const[pass2,setPass2]=useState('');
        const[name,setName]=useState('');
        const[err,setErr]=useState('');
        const[ok,setOk]=useState('');
        const[loading,setLoading]=useState(false);
        const[user,setUser]=useState(null);
        const[vibe,setVibe]=useState(50);
        const[mx,setMx]=useState(50);
        const[my,setMy]=useState(50);
        const[drag,setDrag]=useState(false);
        const[intv,setIntv]=useState(null);
        const[screen,setScreen]=useState(3.2);
        const[steps,setSteps]=useState(1200);
        const[stats,setStats]=useState(false);
        useEffect(()=>{
          const s=localStorage.getItem('eq_session');
          if(s){setUser(JSON.parse(s));setMode('app');}
        },[]);
        useEffect(()=>{
          if(mode!=='app')return;
          const v=Math.round((mx+(100-my))/2);
          setVibe(v);
          const t=Math.min(screen*5,60)+Math.max(0,40-steps/250);
          if(screen>4&&steps<500)setIntv({type:'Digital Paralysis',action:'Shake Out',msg:'Your body needs movement.',dur:'2 min'});
          else if(t>60&&steps<2000)setIntv({type:'Overstimulated',action:'Visual Reset',msg:'Eyes deserve a break.',dur:'3 min'});
          else if(steps<100)setIntv({type:'The Slump',action:'Hydration',msg:'A sip of water helps.',dur:'1 min'});
          else setIntv(null);
        },[screen,steps,mx,my,mode]);
        const signup=()=>{
          setErr('');setOk('');setLoading(true);
          if(!name||!email||!pass||!pass2){setErr('All fields required');setLoading(false);return;}
          if(pass!==pass2){setErr('Passwords do not match');setLoading(false);return;}
          if(pass.length<6){setErr('Password min 6 chars');setLoading(false);return;}
          const k='eq_user_'+email.toLowerCase();
          if(localStorage.getItem(k)){setErr('Email registered');setLoading(false);return;}
          const u={name,email:email.toLowerCase(),pass,uid:'u_'+Date.now()};
          localStorage.setItem(k,JSON.stringify(u));
          localStorage.setItem('eq_session',JSON.stringify({name,email:email.toLowerCase(),uid:u.uid}));
          setUser({name,email:email.toLowerCase(),uid:u.uid});
          setOk('Account created! ðŸŽ‰');
          setTimeout(()=>setMode('app'),1500);
          setLoading(false);
        };
        const login=()=>{
          setErr('');setOk('');setLoading(true);
          if(!email||!pass){setErr('Email and password required');setLoading(false);return;}
          const k='eq_user_'+email.toLowerCase();
          const d=localStorage.getItem(k);
          if(!d){setErr('Account not found');setLoading(false);return;}
          const u=JSON.parse(d);
          if(u.pass!==pass){setErr('Incorrect password');setLoading(false);return;}
          localStorage.setItem('eq_session',JSON.stringify({name:u.name,email:u.email,uid:u.uid}));
          setUser({name:u.name,email:u.email,uid:u.uid});
          setOk('Welcome back!');
          setTimeout(()=>setMode('app'),1000);
          setLoading(false);
        };
        const logout=()=>{
          localStorage.removeItem('eq_session');
          setUser(null);setMode('login');setEmail('');setPass('');setPass2('');setName('');
        };
        const shape=()=>{
          const p=8,s=Math.max(0.3,vibe/100),cx=150,cy=150,br=80;
          const t=Math.min(screen*5,60)+Math.max(0,40-steps/250);
          let path='M ';
          for(let i=0;i<=p;i++){
            const a=(i/p)*Math.PI*2;
            const n=Math.sin(a*3+t/100*5)*(1-s)*25;
            const r=br+n;
            const x=cx+Math.cos(a)*r;
            const y=cy+Math.sin(a)*r;
            if(i===0)path+=x+','+y+' ';
            else{
              const pa=((i-1)/p)*Math.PI*2;
              const pn=Math.sin(pa*3+t/100*5)*(1-s)*25;
              const pr=br+pn;
              path+='C '+(cx+Math.cos(pa)*(pr+20))+','+(cy+Math.sin(pa)*(pr+20))+' ';
              path+=(cx+Math.cos(a)*(r-20))+','+(cy+Math.sin(a)*(r-20))+' '+x+','+y+' ';
            }
          }
          return path+'Z';
        };
        const mdrag=e=>{
          if(!drag)return;
          const r=e.currentTarget.getBoundingClientRect();
          const cx=e.touches?e.touches[0].clientX:e.clientX;
          const cy=e.touches?e.touches[0].clientY:e.clientY;
          setMx(Math.max(0,Math.min(100,((cx-r.left)/r.width)*100)));
          setMy(Math.max(0,Math.min(100,((cy-r.top)/r.height)*100)));
        };
        const vc=()=>vibe>=75?'from-emerald-400 to-teal-500':vibe>=50?'from-amber-400 to-orange-500':vibe>=25?'from-orange-400 to-rose-500':'from-rose-400 to-red-500';
        const vt=()=>vibe>=75?'Excellent':vibe>=50?'Good':vibe>=25?'Low':'Need Support';
        const gc=()=>{
          const t=Math.min(screen*5,60)+Math.max(0,40-steps/250);
          return t<30?'from-emerald-400 to-teal-500':t<60?'from-amber-400 to-orange-500':'from-rose-400 to-red-500';
        };
        const sc=()=>screen<2?'ðŸ“± Excellent!':screen<4?'â° Healthy':screen<6?'ðŸ‘€ Break soon':screen<8?'ðŸŒ™ High time':'ðŸ’™ Rest';
        const stc=()=>steps>=8000?'ðŸƒ Amazing!':steps>=5000?'ðŸ‘Ÿ Great!':steps>=2000?'ðŸš¶ Good!':steps>=500?'ðŸŒ¿ Moving!':'ðŸ’« Walk?';
        const mc=()=>{
          const pos=mx>50,hi=my<50;
          return pos&&hi?'ðŸŽ‰ Energized!':pos&&!hi?'ðŸ˜Œ Calm':!pos&&hi?'âš¡ Intense':'ðŸŒ™ Low energy OK';
        };
        if(mode!=='app'){
          return h('div',{className:'min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-white flex items-center justify-center p-6'},
            h('div',{className:'w-full max-w-md'},
              h('div',{className:'text-center mb-12'},
                h('div',{className:'w-20 h-20 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center mb-4 mx-auto text-4xl'},'ðŸ’š'),
                h('h1',{className:'text-4xl font-light mb-2'},'Equilibrium'),
                h('p',{className:'text-white/50 text-sm'},'Mental health companion')
              ),
              h('div',{className:'bg-white/5 border border-white/10 rounded-3xl p-8 backdrop-blur-xl'},
                mode==='login'?
                  h('div',null,
                    h('h2',{className:'text-2xl font-light mb-6'},'Welcome Back'),
                    h('div',{className:'space-y-4 mb-6'},
                      h('div',null,h('label',{className:'block text-sm text-white/60 mb-2'},'Email'),h('input',{type:'email',value:email,onChange:e=>setEmail(e.target.value),onKeyPress:e=>e.key==='Enter'&&login(),className:'w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-teal-500',placeholder:'you@example.com'})),
                      h('div',null,h('label',{className:'block text-sm text-white/60 mb-2'},'Password'),h('input',{type:'password',value:pass,onChange:e=>setPass(e.target.value),onKeyPress:e=>e.key==='Enter'&&login(),className:'w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-teal-500',placeholder:'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢'}))
                    ),
                    err&&h('div',{className:'text-rose-400 text-sm mb-4 p-3 bg-rose-500/10 rounded-lg'},'âš ï¸ '+err),
                    ok&&h('div',{className:'text-emerald-400 text-sm mb-4 p-3 bg-emerald-500/10 rounded-lg'},'âœ“ '+ok),
                    h('button',{onClick:login,disabled:loading,className:'w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white rounded-xl py-3 font-medium disabled:opacity-50'},loading?'Signing in...':'Sign In'),
                    h('div',{className:'mt-6 text-center text-sm text-white/40'},"Don't have an account? ",h('button',{type:'button',onClick:()=>setMode('signup'),className:'text-teal-400 hover:text-teal-300'},'Sign up'))
                  ):
                  h('div',null,
                    h('h2',{className:'text-2xl font-light mb-6'},'Create Account'),
                    h('div',{className:'space-y-4 mb-6'},
                      h('div',null,h('label',{className:'block text-sm text-white/60 mb-2'},'Name'),h('input',{type:'text',value:name,onChange:e=>setName(e.target.value),className:'w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-teal-500',placeholder:'Your name'})),
                      h('div',null,h('label',{className:'block text-sm text-white/60 mb-2'},'Email'),h('input',{type:'email',value:email,onChange:e=>setEmail(e.target.value),className:'w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-teal-500',placeholder:'you@example.com'})),
                      h('div',null,h('label',{className:'block text-sm text-white/60 mb-2'},'Password'),h('input',{type:'password',value:pass,onChange:e=>setPass(e.target.value),className:'w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-teal-500',placeholder:'Min 6 characters'})),
                      h('div',null,h('label',{className:'block text-sm text-white/60 mb-2'},'Confirm'),h('input',{type:'password',value:pass2,onChange:e=>setPass2(e.target.value),onKeyPress:e=>e.key==='Enter'&&signup(),className:'w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-teal-500',placeholder:'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢'}))
                    ),
                    err&&h('div',{className:'text-rose-400 text-sm mb-4 p-3 bg-rose-500/10 rounded-lg'},'âš ï¸ '+err),
                    ok&&h('div',{className:'text-emerald-400 text-sm mb-4 p-3 bg-emerald-500/10 rounded-lg'},'âœ“ '+ok),
                    h('button',{onClick:signup,disabled:loading,className:'w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white rounded-xl py-3 font-medium disabled:opacity-50'},loading?'Creating...':'Create Account'),
                    h('div',{className:'mt-6 text-center text-sm text-white/40'},'Have account? ',h('button',{type:'button',onClick:()=>setMode('login'),className:'text-teal-400 hover:text-teal-300'},'Sign in'))
                  ),
                h('div',{className:'mt-8 pt-6 border-t border-white/10'},h('p',{className:'text-xs text-white/30 text-center'},'ðŸ’¾ Local Storage â€¢ Privacy First'))
              )
            )
          );
        }
        return h('div',{className:'min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-white'},
          h('div',{className:'bg-white/5 border-b border-white/10 backdrop-blur-xl'},
            h('div',{className:'max-w-4xl mx-auto px-6 py-4 flex justify-between items-center'},
              h('div',null,h('h1',{className:'text-2xl font-light'},'Equilibrium'),h('p',{className:'text-xs text-white/40'},'Welcome, '+(user?.name||''))),
              h('div',{className:'flex items-center gap-4'},
                h('button',{onClick:()=>setStats(!stats),className:'px-4 py-2 bg-teal-500/20 text-teal-400 rounded-xl text-sm'},stats?'Hide Stats':'Show Stats'),
                h('button',{onClick:logout,className:'text-sm text-white/60 hover:text-white px-3 py-2'},'Sign Out')
              )
            )
          ),
          h('div',{className:'max-w-4xl mx-auto px-6 py-12'},
            h('div',{className:'flex justify-center mb-12'},
              h('div',{className:'relative'},
                h('svg',{width:'300',height:'300'},
                  h('defs',null,
                    h('linearGradient',{id:'grad',x1:'0%',y1:'0%',x2:'100%',y2:'100%'},
                      h('stop',{offset:'0%',stopColor:vibe>=75?'#34d399':vibe>=50?'#fbbf24':vibe>=25?'#fb923c':'#f87171'}),
                      h('stop',{offset:'100%',stopColor:vibe>=75?'#14b8a6':vibe>=50?'#f97316':vibe>=25?'#f87171':'#dc2626'})
                    )
                  ),
                  h('path',{d:shape(),fill:'url(#grad)',fillOpacity:'0.3',stroke:'url(#grad)',strokeWidth:'2',className:'transition-all duration-1000'})
                ),
                h('div',{className:'absolute inset-0 flex items-center justify-center'},
                  h('div',{className:'text-center'},
                    h('div',{className:'text-5xl font-extralight bg-gradient-to-r '+vc()+' bg-clip-text text-transparent'},vibe),
                    h('div',{className:'text-sm text-white/40 mt-2'},vt())
                  )
                )
              )
            ),
            intv&&h('div',{className:'bg-white/5 border border-white/10 rounded-3xl p-8 mb-8'},
              h('div',{className:'flex items-start gap-4'},
                h('div',{className:'w-12 h-12 rounded-full bg-gradient-to-br '+gc()+' flex items-center justify-center text-2xl'},'ðŸ’š'),
                h('div',{className:'flex-1'},
                  h('div',{className:'text-sm text-white/50 mb-1'},intv.type),
                  h('h3',{className:'text-xl font-light mb-2'},intv.action),
                  h('p',{className:'text-white/70 mb-4'},intv.msg),
                  h('button',{className:'px-6 py-2 bg-white/10 hover:bg-white/20 rounded-full text-sm'},'Start '+intv.dur)
                )
              )
            ),
            h('div',{className:'bg-white/5 border border-white/10 rounded-3xl p-8 mb-8'},
              h('h3',{className:'text-xl font-light mb-6 text-center'},'Vibe Check - Drag Orb'),
              h('div',{
                className:'relative w-full h-64 rounded-2xl bg-gradient-to-br from-slate-800/50 to-slate-900/50 border border-white/10 cursor-crosshair',
                onMouseDown:()=>setDrag(true),
                onMouseUp:()=>setDrag(false),
                onMouseLeave:()=>setDrag(false),
                onMouseMove:mdrag,
                onTouchStart:()=>setDrag(true),
                onTouchEnd:()=>setDrag(false),
                onTouchMove:mdrag
              },
                h('div',{className:'absolute left-1/2 top-0 bottom-0 w-px bg-white/10'}),
                h('div',{className:'absolute top-1/2 left-0 right-0 h-px bg-white/10'}),
                h('div',{className:'absolute top-2 left-1/2 transform -translate-x-1/2 text-xs text-white/40'},'High Energy'),
                h('div',{className:'absolute bottom-2 left-1/2 transform -translate-x-1/2 text-xs text-white/40'},'Low Energy'),
                h('div',{className:'absolute left-2 top-1/2 transform -translate-y-1/2 text-xs text-white/40'},'Negative'),
                h('div',{className:'absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-white/40'},'Positive'),
                h('div',{className:'absolute w-16 h-16 rounded-full bg-gradient-to-br '+vc()+' blur-sm',style:{left:mx+'%',top:my+'%',transform:'translate(-50%, -50%)'}}),
                h('div',{className:'absolute w-12 h-12 rounded-full bg-gradient-to-br '+vc(),style:{left:mx+'%',top:my+'%',transform:'translate(-50%, -50%)'}})
              ),
              h('p',{className:'text-center text-sm text-white/50 mt-4'},'Drag to show mood'),
              h('p',{className:'text-center text-sm text-teal-400/80 mt-2'},mc())
            ),
            stats&&h('div',{className:'bg-white/5 border border-white/10 rounded-3xl p-8'},
              h('h3',{className:'text-xl font-light mb-6'},"Today's Signals"),
              h('div',{className:'grid grid-cols-1 md:grid-cols-2 gap-6'},
                h('div',null,
                  h('div',{className:'text-sm text-white/50 mb-2'},'ðŸ“± Screen Time'),
                  h('div',{className:'text-3xl font-light'},screen.toFixed(1),h('span',{className:'text-lg text-white/40'},'h')),
                  h('input',{type:'range',min:'0',max:'12',step:'0.1',value:screen,onChange:e=>setScreen(parseFloat(e.target.value)),className:'w-full mt-3'}),
                  h('p',{className:'text-xs text-emerald-400/80 mt-2'},sc())
                ),
                h('div',null,
                  h('div',{className:'text-sm text-white/50 mb-2'},'ðŸ‘Ÿ Steps'),
                  h('div',{className:'text-3xl font-light'},steps.toLocaleString()),
                  h('input',{type:'range',min:'0',max:'10000',step:'100',value:steps,onChange:e=>setSteps(parseInt(e.target.value)),className:'w-full mt-3'}),
                  h('p',{className:'text-xs text-emerald-400/80 mt-2'},stc())
                )
              )
            ),
            h('div',{className:'text-center mt-12'},
              h('p',{className:'text-white/30 text-sm italic'},'The app that knows you need a break before you do.')
            )
          )
        );
      }
      render(h(App),document.getElementById('root'));
    });
  </script>
</body>
</html>