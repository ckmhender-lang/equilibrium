<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Equilibrium">
  <meta name="description" content="The app that knows you need a break before you do">
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiRXF1aWxpYnJpdW0gLSBNZW50YWwgSGVhbHRoIENvbXBhbmlvbiIsInNob3J0X25hbWUiOiJFcXVpbGlicml1bSIsImRlc2NyaXB0aW9uIjoiVGhlIGFwcCB0aGF0IGtub3dzIHlvdSBuZWVkIGEgYnJlYWsgYmVmb3JlIHlvdSBkbyIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMGYxNzJhIiwidGhlbWVfY29sb3IiOiIjMGYxNzJhIiwib3JpZW50YXRpb24iOiJwb3J0cmFpdCIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDIwMCAyMDAnJTNFJTNDZGVmcyUzRSUzQ2xpbmVhckdyYWRpZW50IGlkPSdnJyB4MT0nMCUyNScgeTE9JzAlMjUnIHgyPScxMDAlMjUnIHkyPScxMDAlMjUnJTNFJTNDc3RvcCBvZmZzZXQ9JzAlMjUnIHN0eWxlPSdzdG9wLWNvbG9yOiUyMzEwYjk4MScvJTNFJTNDc3RvcCBvZmZzZXQ9JzEwMCUyNScgc3R5bGU9J3N0b3AtY29sb3I6JTIzMTRiOGE2Jy8lM0UlM0MvbGluZWFyR3JhZGllbnQlM0UlM0MvZGVmcyUzRSUzQ3JlY3Qgd2lkdGg9JzIwMCcgaGVpZ2h0PScyMDAnIGZpbGw9JyUyMzBmMTcyYScvJTNFJTNDcGF0aCBkPSdNMTAwIDYwIEwxMjAgODAgTDE0MCA3MCBMMTUwIDkwIEwxMzAgMTEwIEwxNDAgMTMwIEwxMjAgMTQwIEwxMTAgMTYwIEw5MCAxNjAgTDgwIDE0MCBMNjAgMTMwIEw3MCAxMTAgTDUwIDkwIEw2MCA3MCBMODAgODAgWicgZmlsbD0ndXJsKCUyM2cpJy8lM0UlM0Mvc3ZnJTNFIiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwiLCJwdXJwb3NlIjoiYW55IG1hc2thYmxlIn0seyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDUxMiA1MTInJTNFJTNDZGVmcyUzRSUzQ2xpbmVhckdyYWRpZW50IGlkPSdnJyB4MT0nMCUyNScgeTE9JzAlMjUnIHgyPScxMDAlMjUnIHkyPScxMDAlMjUnJTNFJTNDc3RvcCBvZmZzZXQ9JzAlMjUnIHN0eWxlPSdzdG9wLWNvbG9yOiUyMzEwYjk4MScvJTNFJTNDc3RvcCBvZmZzZXQ9JzEwMCUyNScgc3R5bGU9J3N0b3AtY29sb3I6JTIzMTRiOGE2Jy8lM0UlM0MvbGluZWFyR3JhZGllbnQlM0UlM0MvZGVmcyUzRSUzQ3JlY3Qgd2lkdGg9JzUxMicgaGVpZ2h0PSc1MTInIGZpbGw9JyUyMzBmMTcyYScvJTNFJTNDcGF0aCBkPSdNMjU2IDE1MCBMMzAwIDIwMCBMMzUwIDE4MCBMMzgwIDIzMCBMMzMwIDI4MCBMMzUwIDMzMCBMMzAwIDM1MCBMMjgwIDQwMCBMMjMwIDQwMCBMMjEwIDM1MCBMMTYwIDMzMCBMMTgwIDI4MCBMMTMwIDIzMCBMMTYwIDE4MCBMMjEwIDIwMCBaJyBmaWxsPSd1cmwoJTIzZyknLyUzRSUzQy9zdmclM0UiLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCIsInB1cnBvc2UiOiJhbnkgbWFza2FibGUifV19">
  <title>Equilibrium - Mental Health Companion</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      overscroll-behavior: none;
      touch-action: pan-x pan-y;
    }
    .install-prompt {
      position: fixed; bottom: 20px; left: 20px; right: 20px;
      background: linear-gradient(135deg, #10b981, #14b8a6);
      color: white; padding: 16px; border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 1000;
      animation: slideUp 0.3s ease;
    }
    @keyframes slideUp {
      from { transform: translateY(100px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    input[type="range"] {
      -webkit-appearance: none; appearance: none;
      background: rgba(255,255,255,0.1); height: 6px; border-radius: 3px;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 20px; height: 20px;
      background: linear-gradient(135deg, #10b981, #14b8a6);
      border-radius: 50%; cursor: pointer;
    }
    input[type="range"]::-moz-range-thumb {
      width: 20px; height: 20px;
      background: linear-gradient(135deg, #10b981, #14b8a6);
      border-radius: 50%; cursor: pointer; border: none;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        const sw = `
          const CACHE = 'equilibrium-v1';
          self.addEventListener('install', e => {
            e.waitUntil(caches.open(CACHE).then(c => c.addAll(['/'])));
          });
          self.addEventListener('fetch', e => {
            e.respondWith(caches.match(e.request).then(r => r || fetch(e.request)));
          });
        `;
        const blob = new Blob([sw], {type: 'application/javascript'});
        navigator.serviceWorker.register(URL.createObjectURL(blob));
      });
    }

    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', e => {
      e.preventDefault();
      deferredPrompt = e;
      if (!localStorage.getItem('installDismissed')) {
        const div = document.createElement('div');
        div.className = 'install-prompt';
        div.innerHTML = `
          <div class="flex items-center justify-between gap-4">
            <div class="flex-1">
              <div class="font-semibold mb-1">Install Equilibrium</div>
              <div class="text-sm opacity-90">Add to home screen for best experience</div>
            </div>
            <button onclick="installApp()" class="bg-white text-teal-600 px-4 py-2 rounded-lg font-medium">Install</button>
            <button onclick="dismissInstall()" class="text-white/80 hover:text-white ml-2">âœ•</button>
          </div>
        `;
        document.body.appendChild(div);
      }
    });

    window.installApp = async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
      }
      document.querySelector('.install-prompt')?.remove();
    };

    window.dismissInstall = () => {
      localStorage.setItem('installDismissed', 'true');
      document.querySelector('.install-prompt')?.remove();
    };

    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    const isStandalone = window.navigator.standalone;
    if (isIOS && !isStandalone && !localStorage.getItem('iosDismissed')) {
      setTimeout(() => {
        const div = document.createElement('div');
        div.className = 'install-prompt';
        div.innerHTML = `
          <div class="flex items-start justify-between gap-4">
            <div class="flex-1">
              <div class="font-semibold mb-2">Install on iOS</div>
              <div class="text-sm opacity-90">Tap <b>Share âŽ™</b> then <b>Add to Home Screen</b></div>
            </div>
            <button onclick="this.parentElement.parentElement.remove(); localStorage.setItem('iosDismissed','true');" class="text-white/80">âœ•</button>
          </div>
        `;
        document.body.appendChild(div);
      }, 2000);
    }
  </script>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script>
    const { useState, useEffect, createElement: h } = React;
    
    const HeartIcon = () => h('svg', {xmlns:'http://www.w3.org/2000/svg',width:24,height:24,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor',strokeWidth:2}, h('path',{d:'M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z'}));
    const ActivityIcon = () => h('svg', {xmlns:'http://www.w3.org/2000/svg',width:20,height:20,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor',strokeWidth:2}, h('path',{d:'M22 12h-4l-3 9L9 3l-3 9H2'}));
    const SmartphoneIcon = () => h('svg', {xmlns:'http://www.w3.org/2000/svg',width:16,height:16,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor',strokeWidth:2}, h('rect',{width:14,height:20,x:5,y:2,rx:2,ry:2}), h('path',{d:'M12 18h.01'}));
    const TrendingIcon = () => h('svg', {xmlns:'http://www.w3.org/2000/svg',width:16,height:16,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor',strokeWidth:2}, h('polyline',{points:'22 7 13.5 15.5 8.5 10.5 2 17'}), h('polyline',{points:'16 7 22 7 22 13'}));

    function App() {
      const [mode, setMode] = useState('login');
      const [email, setEmail] = useState('');
      const [pass, setPass] = useState('');
      const [pass2, setPass2] = useState('');
      const [name, setName] = useState('');
      const [err, setErr] = useState('');
      const [ok, setOk] = useState('');
      const [loading, setLoading] = useState(false);
      const [user, setUser] = useState(null);
      const [vibe, setVibe] = useState(50);
      const [mx, setMx] = useState(50);
      const [my, setMy] = useState(50);
      const [drag, setDrag] = useState(false);
      const [intv, setIntv] = useState(null);
      const [screen, setScreen] = useState(3.2);
      const [steps, setSteps] = useState(1200);
      const [stats, setStats] = useState(false);

      useEffect(() => {
        const s = localStorage.getItem('eq_session');
        if (s) { setUser(JSON.parse(s)); setMode('app'); }
      }, []);

      useEffect(() => {
        if (mode !== 'app') return;
        const v = Math.round((mx + (100 - my)) / 2);
        setVibe(v);
        const t = Math.min(screen * 5, 60) + Math.max(0, 40 - steps / 250);
        if (screen > 4 && steps < 500) setIntv({type:'Digital Paralysis',action:'Shake Out',msg:'Your body needs movement.',dur:'2 min'});
        else if (t > 60 && steps < 2000) setIntv({type:'Overstimulated',action:'Visual Reset',msg:'Eyes deserve a break.',dur:'3 min'});
        else if (steps < 100) setIntv({type:'The Slump',action:'Hydration',msg:'A sip of water helps.',dur:'1 min'});
        else setIntv(null);
      }, [screen, steps, mx, my, mode]);

      const signup = () => {
        setErr(''); setOk(''); setLoading(true);
        if (!name || !email || !pass || !pass2) { setErr('All fields required'); setLoading(false); return; }
        if (pass !== pass2) { setErr('Passwords do not match'); setLoading(false); return; }
        if (pass.length < 6) { setErr('Password min 6 chars'); setLoading(false); return; }
        const k = 'eq_user_' + email.toLowerCase();
        if (localStorage.getItem(k)) { setErr('Email registered'); setLoading(false); return; }
        const u = {name, email: email.toLowerCase(), pass, uid: 'u_' + Date.now()};
        localStorage.setItem(k, JSON.stringify(u));
        localStorage.setItem('eq_session', JSON.stringify({name, email: email.toLowerCase(), uid: u.uid}));
        setUser({name, email: email.toLowerCase(), uid: u.uid});
        setOk('Account created! ðŸŽ‰');
        setTimeout(() => setMode('app'), 1500);
        setLoading(false);
      };

      const login = () => {
        setErr(''); setOk(''); setLoading(true);
        if (!email || !pass) { setErr('Email and password required'); setLoading(false); return; }
        const k = 'eq_user_' + email.toLowerCase();
        const d = localStorage.getItem(k);
        if (!d) { setErr('Account not found'); setLoading(false); return; }
        const u = JSON.parse(d);
        if (u.pass !== pass) { setErr('Incorrect password'); setLoading(false); return; }
        localStorage.setItem('eq_session', JSON.stringify({name: u.name, email: u.email, uid: u.uid}));
        setUser({name: u.name, email: u.email, uid: u.uid});
        setOk('Welcome back!');
        setTimeout(() => setMode('app'), 1000);
        setLoading(false);
      };

      const logout = () => {
        localStorage.removeItem('eq_session');
        setUser(null); setMode('login'); setEmail(''); setPass(''); setPass2(''); setName('');
      };

      const shape = () => {
        const p = 8, s = Math.max(0.3, vibe / 100), cx = 150, cy = 150, br = 80;
        const t = Math.min(screen * 5, 60) + Math.max(0, 40 - steps / 250);
        let path = 'M ';
        for (let i = 0; i <= p; i++) {
          const a = (i / p) * Math.PI * 2;
          const n = Math.sin(a * 3 + t / 100 * 5) * (1 - s) * 25;
          const r = br + n;
          const x = cx + Math.cos(a) * r;
          const y = cy + Math.sin(a) * r;
          if (i === 0) path += x + ',' + y + ' ';
          else {
            const pa = ((i - 1) / p) * Math.PI * 2;
            const pn = Math.sin(pa * 3 + t / 100 * 5) * (1 - s) * 25;
            const pr = br + pn;
            path += 'C ' + (cx + Math.cos(pa) * (pr + 20)) + ',' + (cy + Math.sin(pa) * (pr + 20)) + ' ';
            path += (cx + Math.cos(a) * (r - 20)) + ',' + (cy + Math.sin(a) * (r - 20)) + ' ' + x + ',' + y + ' ';
          }
        }
        return path + 'Z';
      };

      const mdrag = e => {
        if (!drag) return;
        const r = e.currentTarget.getBoundingClientRect();
        const cx = e.touches ? e.touches[0].clientX : e.clientX;
        const cy = e.touches ? e.touches[0].clientY : e.clientY;
        setMx(Math.max(0, Math.min(100, ((cx - r.left) / r.width) * 100)));
        setMy(Math.max(0, Math.min(100, ((cy - r.top) / r.height) * 100)));
      };

      const vc = () => vibe >= 75 ? 'from-emerald-400 to-teal-500' : vibe >= 50 ? 'from-amber-400 to-orange-500' : vibe >= 25 ? 'from-orange-400 to-rose-500' : 'from-rose-400 to-red-500';
      const vt = () => vibe >= 75 ? 'Excellent' : vibe >= 50 ? 'Good' : vibe >= 25 ? 'Low' : 'Need Support';
      const gc = () => {
        const t = Math.min(screen * 5, 60) + Math.max(0, 40 - steps / 250);
        return t < 30 ? 'from-emerald-400 to-teal-500' : t < 60 ? 'from-amber-400 to-orange-500' : 'from-rose-400 to-red-500';
      };
      const sc = () => screen < 2 ? 'ðŸ“± Excellent balance!' : screen < 4 ? 'â° Healthy usage' : screen < 6 ? 'ðŸ‘€ Break soon' : screen < 8 ? 'ðŸŒ™ High time' : 'ðŸ’™ Time to rest';
      const stc = () => steps >= 8000 ? 'ðŸƒ Amazing!' : steps >= 5000 ? 'ðŸ‘Ÿ Great!' : steps >= 2000 ? 'ðŸš¶ Good!' : steps >= 500 ? 'ðŸŒ¿ Moving!' : 'ðŸ’« Walk?';
      const mc = () => {
        const pos = mx > 50, hi = my < 50;
        return pos && hi ? 'ðŸŽ‰ Energized!' : pos && !hi ? 'ðŸ˜Œ Calm' : !pos && hi ? 'âš¡ Intense' : 'ðŸŒ™ Low energy OK';
      };

      if (mode !== 'app') {
        return h('div', {className: 'min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-white flex items-center justify-center p-6'},
          h('div', {className: 'w-full max-w-md'},
            h('div', {className: 'text-center mb-12'},
              h('div', {className: 'w-20 h-20 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center mb-4 mx-auto'}, h(HeartIcon)),
              h('h1', {className: 'text-4xl font-light mb-2'}, 'Equilibrium'),
              h('p', {className: 'text-white/50 text-sm'}, 'The app that knows you need a break before you do')
            ),
            h('div', {className: 'bg-white/5 border border-white/10 rounded-3xl p-8 backdrop-blur-xl'},
              mode === 'login' ?
                h('div', null,
                  h('h2', {className: 'text-2xl font-light mb-6'}, 'Welcome Back'),
                  h('div', {className: 'space-y-4 mb-6'},
                    h('div', null, h('label', {className: 'block text-sm text-white/60 mb-2'}, 'Email'), h('input', {type: 'email', value: email, onChange: e => setEmail(e.target.value), onKeyPress: e => e.key === 'Enter' && login(), className: 'w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-teal-500', placeholder: 'you@example.com'})),
                    h('div', null, h('label', {className: 'block text-sm text-white/60 mb-2'}, 'Password'), h('input', {type: 'password', value: pass, onChange: e => setPass(e.target.value), onKeyPress: e => e.key === 'Enter' && login(), className: 'w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-teal-500', placeholder: 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢'}))
                  ),
                  err && h('div', {className: 'text-rose-400 text-sm mb-4 p-3 bg-rose-500/10 rounded-lg'}, 'âš ï¸ ' + err),
                  ok && h('div', {className: 'text-emerald-400 text-sm mb-4 p-3 bg-emerald-500/10 rounded-lg'}, 'âœ“ ' + ok),
                  h('button', {onClick: login, disabled: loading, className: 'w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white rounded-xl py-3 font-medium disabled:opacity-50'}, loading ? 'Signing in...' : 'Sign In'),
                  h('div', {className: 'mt-6 text-center text-sm text-white/40'}, "Don't have an account? ", h('button', {type: 'button', onClick: () => setMode('signup'), className: 'text-teal-400 hover:text-teal-300'}, 'Sign up'))
                ) :
                h('div', null,
                  h('h2', {className: 'text-2xl font-light mb-6'}, 'Create Account'),
                  h('div', {className: 'space-y-4 mb-6'},
                    h('div', null, h('label', {className: 'block text-sm text-white/60 mb-2'}, 'Name'), h('input', {type: 'text', value: name, onChange: e => setName(e.target.value), className: 'w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-teal-500', placeholder: 'Your name'})),
                    h('div', null, h('label', {className: 'block text-sm text-white/60 mb-2'}, 'Email'), h('input', {type: 'email', value: email, onChange: e => setEmail(e.target.value), className: 'w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-teal-500', placeholder: 'you@example.com'})),
                    h('div', null, h('label', {className: 'block text-sm text-white/60 mb-2'}, 'Password'), h('input', {type: 'password', value: pass, onChange: e => setPass(e.target.value), className: 'w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-teal-500', placeholder: 'Min 6 characters'})),
                    h('div', null, h('label', {className: 'block text-sm text-white/60 mb-2'}, 'Confirm Password'), h('input', {type: 'password', value: pass2, onChange: e => setPass2(e.target.value), onKeyPress: e => e.key === 'Enter' && signup(), className: 'w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/30 focus:outline-none focus:border-teal-500', placeholder: 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢'}))
                  ),
                  err && h('div', {className: 'text-rose-400 text-sm mb-4 p-3 bg-rose-500/10 rounded-lg'}, 'âš ï¸ ' + err),
                  ok && h('div', {className: 'text-emerald-400 text-sm mb-4 p-3 bg-emerald-500/10 rounded-lg'}, 'âœ“ ' + ok),
                  h('button', {onClick: signup, disabled: loading, className: 'w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white rounded-xl py-3 font-medium disabled:opacity-50'}, loading ? 'Creating...' : 'Create Account'),
                  h('div', {className: 'mt-6 text-center text-sm text-white/40'}, 'Already have an account? ', h('button', {type: 'button', onClick: () => setMode('login'), className: 'text-teal-400 hover:text-teal-300'}, 'Sign in'))
                ),
              h('div', {className: 'mt-8 pt-6 border-t border-white/10'}, h('p', {className: 'text-xs text-white/30 text-center'}, 'ðŸ’¾ Local Storage â€¢ Privacy First'))
            )
          )
        );
      }

      return h('div', {className: 'min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-white'},
        h('div', {className: 'bg-white/5 border-b border-white/10 backdrop-blur-xl'},
          h('div', {className: 'max-w-4xl mx-auto px-6 py-4 flex justify-between items-center'},
            h('div', null, h('h1', {className
